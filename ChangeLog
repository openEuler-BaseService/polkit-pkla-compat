2006-06-06  David Zeuthen  <davidz@redhat.com>

	Patch from Frederic Peters <fpeters@entrouvert.com>. jhbuild
	monitors files being installed and prevents them from being
	written out of its target directory.  This means HAL now prevents
	jhautobuild[1] to complete since pam-polkit-console hardcodes
	/lib/security. Attached is a patch with a configure
	option (--with-pam-module-dir) so it is possible to set an other
	directory. [1] http://jhbuild.bxlug.be

	* pam-polkit-console/Makefile.am: 
	* configure.in: 

2006-06-06  David Zeuthen  <davidz@redhat.com>

	Patch from Frederic Peters <fpeters@entrouvert.com>.
	http://jhbuild.bxlug.be/builds/2006-06-06-0000/logs/PolicyKit/#build
	shows a error when building newest PolicyKit with Debian PAM
	libraries.

	Attached patch adds new configure checks; pam-polkit-console.c may
	need alternate behaviour if pam_vsyslog is missing (using straight
	vsyslog?).

	* configure.in,
	* pam-polkit-console/pam-polkit-console.c: (_pam_log):
	* doc/TODO:

2006-06-05  David Zeuthen  <davidz@redhat.com>

	Lots of changes! Almost ready for 0.2 release.

	* Makefile.am:
	* README:
	* configure.in:
	* doc/TODO:
	* doc/api/polkit-docs.xml:
	* doc/spec/Makefile.am:
	* doc/spec/polkit-spec.html:
	* doc/spec/polkit-spec.xml.in:
	* libpolkit/Makefile.am:
	* libpolkit/libpolkit-grant.c: (have_questions_handler),
	(libpolkit_grant_provide_answers), (auth_done_handler),
	(libpolkit_grant_new_context),
	(libpolkit_grant_get_libpolkit_context),
	(libpolkit_grant_set_questions_handler),
	(libpolkit_grant_set_grant_complete_handler),
	(libpolkit_grant_initiate_temporary_grant),
	(libpolkit_grant_get_user_for_auth),
	(libpolkit_grant_get_pam_service_for_auth),
	(libpolkit_grant_close), (libpolkit_grant_free_context),
	(libpolkit_grant_get_user), (libpolkit_grant_get_privilege),
	(libpolkit_grant_get_resource):
	* libpolkit/libpolkit-grant.h:
	* libpolkit/libpolkit.c:
	(libpolkit_get_allowed_resources_for_privilege_for_uid),
	(libpolkit_is_uid_allowed_for_privilege):
	* libpolkit/libpolkit.h:
	* pam-polkit-console/Makefile.am:
	* pam-polkit-console/pam-polkit-console.c: (_pam_log),
	(_parse_module_args), (_is_local_xconsole), (_poke_polkitd),
	(pam_sm_authenticate), (pam_sm_setcred), (pam_sm_open_session),
	(pam_sm_close_session):
	* polkit-interface-manager.xml:
	* polkit-interface-session.xml:
	* polkit.pc.in:
	* polkitd/PolicyKit.in:
	* polkitd/main.c: (handle_sigusr1), (sigusr1_iochn_data), (main):
	* polkitd/policy.c: (txt_backend_read_policy),
	(txt_backend_read_list), (txt_backend_read_word),
	(policy_get_sufficient_privileges),
	(policy_get_required_privileges),
	(policy_get_auth_details_for_policy),
	(_policy_is_uid_gid_allowed_for_policy),
	(policy_is_uid_gid_allowed_for_policy),
	(policy_is_uid_allowed_for_policy):
	* polkitd/policy.h:
	* polkitd/polkit-manager.c: (_granting_temp_priv),
	(_revoking_temp_priv), (polkit_manager_error_get_type),
	(bus_name_owner_changed), (polkit_manager_get_caller_info),
	(_check_for_temp_privilege),
	(polkit_manager_initiate_temporary_privilege_grant),
	(polkit_manager_is_user_privileged),
	(polkit_manager_get_allowed_resources_for_privilege),
	(polkit_manager_revoke_temporary_privilege),
	(polkit_manager_add_temporary_privilege),
	(polkit_manager_remove_temporary_privilege),
	(polkit_manager_update_desktop_console_privileges):
	* polkitd/polkit-manager.h:
	* polkitd/polkit-session.c: (polkit_session_close),
	(polkit_session_grant_privilege_temporarily), (polkit_session_new),
	(polkit_session_initiator_disconnected):
	* polkitd/polkit-session.h:
	* privileges/desktop-console.privilege:
	* tools/Makefile.am:
	* tools/polkit-grant-privilege.c: (questions_cb),
	(grant_complete_cb), (main):
	* tools/polkit-is-privileged.c: (usage), (main):
	* tools/polkit-list-privileges.c: (main):
	* tools/polkit-revoke-privilege.c: (main):

2006-04-22  David Zeuthen  <davidz@redhat.com>

	* tools/polkit-list-privileges.c (main): Update to new D-BUS API;
	print " (temporary)" for privilege if appropriate.

	* tools/polkit-is-privileged.c (main): Update to new D-BUS API

	* tools/polkit-grant-privilege.c: 
	(do_grant_privilege): Update to new D-BUS API
	(main): --do--

	* tools/polkit-revoke-privilege.c: New file

	* tools/Makefile.am: Add build rules for polkit-revoke-privilege

	* polkitd/polkit-manager.h: Fix up prototypes

	* polkitd/polkit-manager.c:
	(polkit_manager_initiate_temporary_privilege_grant): Update to new
	D-BUS API
	(polkit_manager_get_allowed_resources_for_privilege): --do--
	(polkit_manager_revoke_temporary_privilege): New function
	(polkit_manager_remove_temporary_privilege): Fix up resource handling
	(polkit_manager_add_temporary_privilege): --do--

	* libpolkit/libpolkit.h:
	(libpolkit_get_allowed_resources_for_privilege_for_uid): Update to
	new D-BUS API and export libpolkit_revoke_temporary_privilege()

	* libpolkit/libpolkit.c: 
	(libpolkit_is_uid_allowed_for_privilege): Update to new D-BUS API
	(libpolkit_get_allowed_resources_for_privilege_for_uid): --do--
	(libpolkit_revoke_temporary_privilege): New function

	* polkit-interface-manager.xml: Rename InitiatePrivilegeGrant() to
	InitiateTemporaryPrivilegeGrant(). Add new function
	RevokeTemporaryPrivilege(). Make IsUserPrivileged() output a
	boolean is_temporary. GetAllowedResourcesForPrivilege() now also
	outputs an integer num_non_temp.

2006-04-21  David Zeuthen  <davidz@redhat.com>

	* doc/spec/polkit-spec.xml.in: Write some more stuff 

2006-04-04  Richard Hughes  <richard@hughsie.com>

	* doc/Makefile.am: Add in the new spec directory so we add the folder
	to the tarball.

	* doc/spec/polkit-spec.xml.in: Fix this up in one place so it validates
	and so that make distcheck can run again..

2006-03-29  David Zeuthen  <davidz@redhat.com>

	* configure.in: Add docbook detection
	
	* doc/spec/*: New files
	
	* polkitd/polkit-session.c (polkit_session_finalize): Free the
	questions to prevent memory leak

2006-03-27  Richard Hughes  <richard@hughsie.com>

	* .cvsignore, doc/.cvsignore, libpolkit/.cvsignore,
	polkitd/.cvsignore, privileges/.cvsignore, tools/.cvsignore:
	Add these files.

2006-03-16  David Zeuthen  <davidz@redhat.com>

	* polkitd/polkit-session.c (polkit_session_close): Remember to
	kill the child here

2006-03-16  David Zeuthen  <davidz@redhat.com>

	* polkitd/main.c (main): Bail if we can't become primary owner

	* polkitd/polkit-session.c (data_from_pam): Unref when the child dies
	(polkit_session_initiate_auth): Ref the object after creating child
	(polkit_session_initiator_disconnected): Make sure to nuke the kids

2006-03-15  David Zeuthen  <davidz@redhat.com>

	* polkitd/polkit-manager.h: Include sys/types.h; fixed fd.o
	bug #6280. Patch from Wouter Bolsterlee <uws+freedesktop@xs4all.nl>.

2006-03-14  David Zeuthen  <davidz@redhat.com>

	* polkitd/PolicyKit.in: Change priorities from 90 10 to 98 02 to make
	this work

	* polkitd/PolicyKit.conf.in: Remove user="@POLKIT_USER@" bits as I'm
	not sure we need a dedicated user

	* configure.in: Cosmetic things

2006-03-15  Kay Sievers  <kay.sievers@vrfy.org>

	Add SUSE distro bits.

	* configure.in:
	* policy-kit.in:

2006-03-14  David Zeuthen  <davidz@redhat.com>

	Add a bunch of code; basically a full rewrite moving all queries
	to the daemon.

	* COPYING:
	* Makefile.am:
	* configure.in:
	* libpolkit/Makefile.am:
	* libpolkit/libpolkit-test.c:
	* libpolkit/libpolkit.c: (libpolkit_new_context),
	(libpolkit_free_context),
	(libpolkit_get_allowed_resources_for_privilege_for_uid),
	(libpolkit_is_uid_allowed_for_privilege),
	(libpolkit_get_privilege_list):
	* libpolkit/libpolkit.h:
	* policy-kit.in:
	* polkit-interface-manager.xml:
	* polkit-interface-session.xml:
	* polkit.pc.in:
	* polkitd/Makefile.am:
	* polkitd/debug-polkitd.sh:
	* polkitd/main.c: (usage), (delete_pid), (main):
	* polkitd/policy.c: (policy_util_set_policy_directory),
	(policy_element_new), (policy_element_free),
	(policy_element_free_list), (policy_element_dump),
	(txt_backend_read_policy), (policy_get_whitelist),
	(policy_get_blacklist), (policy_get_policies), (afp_process_elem),
	(policy_get_allowed_resources_for_policy_for_uid_gid),
	(policy_is_uid_gid_allowed_for_policy), (policy_util_uid_to_name),
	(policy_util_gid_to_name), (policy_util_name_to_uid),
	(policy_util_name_to_gid),
	(policy_get_allowed_resources_for_policy_for_uid),
	(policy_is_uid_allowed_for_policy), (getgrouplist):
	* polkitd/policy.h:
	* polkitd/polkit-manager.c: (caller_info_delete),
	(polkit_manager_init), (polkit_manager_finalize),
	(polkit_manager_class_init), (polkit_manager_error_quark),
	(polkit_manager_error_get_type), (bus_name_owner_changed),
	(session_remover), (session_finalized), (polkit_manager_new),
	(uid_from_username), (safe_strcmp),
	(polkit_manager_get_caller_info),
	(polkit_manager_initiate_privilege_grant),
	(polkit_manager_is_user_privileged),
	(polkit_manager_get_allowed_resources_for_privilege),
	(polkit_manager_list_privileges),
	(polkit_manager_add_temporary_privilege),
	(polkit_manager_remove_temporary_privilege):
	* polkitd/polkit-manager.h:
	* polkitd/polkit-marshal.list:
	* polkitd/polkit-session.c: (polkit_session_init),
	(polkit_session_finalize), (polkit_session_class_init),
	(polkit_session_error_quark), (polkit_session_error_get_type),
	(polkit_session_check_caller), (polkit_session_is_authenticated),
	(polkit_session_get_auth_denied_reason), (safe_memset),
	(my_conversation), (write_back_to_parent), (do_pam_auth),
	(data_from_pam), (polkit_session_get_auth_details),
	(polkit_session_initiate_auth), (polkit_session_get_questions),
	(polkit_session_provide_answers), (polkit_session_close),
	(polkit_session_grant_privilege_temporarily), (polkit_session_new),
	(polkit_session_initiator_disconnected):
	* polkitd/polkit-session.h:
	* polkitd/polkitd-test.c: (my_exit), (do_check),
	(write_test_policy), (do_read_tests), (main):
	* polkitd/run-polkitd.sh:
	* polkitd/valgrind-polkitd.sh:
	* privileges/Makefile.am:
	* privileges/desktop-console.privilege:
	* tools/Makefile.am:
	* tools/Makefile.in:
	* tools/polkit-grant-privilege.c: (have_questions_handler),
	(auth_done_handler), (do_grant_privilege), (usage), (main):
	* tools/polkit-is-privileged.c: (usage), (main):
	* tools/polkit-list-privileges.c: (usage), (main):

2006-03-09  David Zeuthen  <davidz@redhat.com>

	* polkit.pc.in (exec_prefix): Use right Cflags

2006-03-07  David Zeuthen  <davidz@redhat.com>

	* tools/polkit-is-privileged.c (usage, main): s/hal-policy/polkit/

2006-03-07  David Zeuthen  <davidz@redhat.com>

	* polkit.pc.in: Use simpler names: user, group and txtsrc :-/

2006-03-07  David Zeuthen  <davidz@redhat.com>

	* polkit.pc.in: Add libpoluser, libpolgroup and libpoltxtsrc variables

2006-03-07  David Zeuthen  <davidz@redhat.com>

	* polkit.pc.in (Libs): s/-llibpolkit/-lpolkit/

2006-03-07  David Zeuthen  <davidz@redhat.com>

	Initial check-in of PolicyKit

